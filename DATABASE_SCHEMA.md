# 股票策略交易系統 - 資料庫規格

## Google Sheets 資料表結構

### 表格名稱
`股票交易記錄` 或 `Stock Trading Records`

---

## 欄位定義

| 欄位編號 | 欄位名稱 | 英文名稱 | 資料型態 | 必填 | 說明 | 範例 |
|---------|---------|---------|---------|------|------|------|
| A | 識別碼 | id | 文字 | ✅ | 唯一識別碼，系統自動產生 | `2330_2026-01-24_20260124112000` |
| B | 股票代號 | ticker | 文字 | ✅ | 台股代號（不含 .TW） | `2330`, `6770`, `0050` |
| C | 進場日期 | entry_date | 日期/文字 | ✅ | 購買日期，格式 YYYY-MM-DD | `2026-01-24` |
| D | 總金額 | total_amount | 數字 | ✅ | 購買總成本（新台幣） | `50000`, `100000` |
| E | 股數 | shares | 數字 | ✅ | 購買股數 | `20`, `1000`, `2000` |
| F | 策略類型 | strategy_type | 文字 | ✅ | Basic（基礎單）或 Add（加碼單） | `Basic`, `Add` |
| G | 已出場 | is_sold | 布林值 | ✅ | 是否已賣出 | `FALSE`, `TRUE` |
| H | 備註 | notes | 文字 | ❌ | 使用者自訂備註 | `測試用`, `力積電第一筆` |

---

## 欄位詳細說明

### A 欄：id（識別碼）

**資料型態**：文字  
**必填**：是  
**格式**：`{ticker}_{entry_date}_{timestamp}`  
**說明**：
- 系統自動產生，不需手動輸入
- 用於唯一識別每一筆交易記錄
- timestamp 為產生時的時間戳記（YYYYMMDDHHmmss）

**範例**：
```
2330_2026-01-24_20260124112000
6770_2026-01-24_20260124113045
```

**驗證規則**：
- 不可重複
- 不可為空

---

### B 欄：ticker（股票代號）

**資料型態**：文字（⚠️ 重要：必須設定為文字格式）  
**必填**：是  
**格式**：4 位數字（台股代號）  
**說明**：
- 台灣股票代號
- 不含 .TW 或 .TWO 後綴
- 必須設定為文字格式以保留前導零

**範例**：
```
2330  (台積電)
6770  (力積電)
0050  (元大台灣50)
```

**驗證規則**：
- 必須是有效的台股代號
- 長度通常為 4 位數
- 必須為文字格式（避免前導零被移除）

**Google Sheets 設定**：
1. 選擇 B 欄
2. 格式 → 數字 → 純文字

---

### C 欄：entry_date（進場日期）

**資料型態**：日期或文字  
**必填**：是  
**格式**：YYYY-MM-DD  
**說明**：
- 股票購買日期
- 必須使用 ISO 8601 格式

**範例**：
```
2026-01-24
2025-12-31
```

**驗證規則**：
- 格式必須為 YYYY-MM-DD
- 不可為未來日期
- 不可早於 1990-01-01

---

### D 欄：total_amount（總金額）

**資料型態**：數字  
**必填**：是  
**格式**：正整數或小數  
**說明**：
- 購買該股票的總成本（新台幣）
- 包含手續費等所有費用

**範例**：
```
50000
100000
250000.5
```

**驗證規則**：
- 必須大於 0
- 建議範圍：1,000 ~ 10,000,000

---

### E 欄：shares（股數）

**資料型態**：數字  
**必填**：是  
**格式**：正整數  
**說明**：
- 購買的股票數量
- 台股通常以「張」或「股」計算
- 1 張 = 1000 股

**範例**：
```
20     (20 股)
1000   (1000 股 = 1 張)
2000   (2000 股 = 2 張)
```

**驗證規則**：
- 必須大於 0
- 必須為整數

---

### F 欄：strategy_type（策略類型）

**資料型態**：文字  
**必填**：是  
**格式**：枚舉值（Basic 或 Add）  
**說明**：
- 交易策略類型
- Basic：基礎單（守月線 MA20）
- Add：加碼單（守兩日低點）

**範例**：
```
Basic
Add
```

**驗證規則**：
- 只能是 `Basic` 或 `Add`
- 大小寫必須正確（首字母大寫）

**策略說明**：
- **Basic（基礎單）**：
  - 停損條件：收盤價 < 20 日均線
  - 適用：長期持有、核心部位
  
- **Add（加碼單）**：
  - 停損條件：收盤價 < 前兩日最低價
  - 適用：短線加碼、波段操作

---

### G 欄：is_sold（已出場）

**資料型態**：布林值  
**必填**：是  
**格式**：TRUE 或 FALSE  
**說明**：
- 標記該部位是否已經賣出
- 新增時預設為 FALSE
- 系統會自動更新為 TRUE

**範例**：
```
FALSE  (未出場，仍在庫存中)
TRUE   (已出場，不在庫存中)
```

**驗證規則**：
- 只能是 `TRUE` 或 `FALSE`
- 必須全大寫

**系統行為**：
- 新增記錄時：自動設為 `FALSE`
- 標記出場時：系統更新為 `TRUE`
- 庫存顯示：只顯示 `is_sold = FALSE` 的記錄

---

### H 欄：notes（備註）

**資料型態**：文字  
**必填**：否（選填）  
**格式**：自由文字  
**說明**：
- 使用者自訂備註
- 可記錄任何相關資訊

**範例**：
```
測試用
力積電第一筆
看好 AI 趨勢
```

**驗證規則**：
- 無特殊限制
- 建議長度：0-200 字元

---

## 資料範例

### 完整範例資料

| id | ticker | entry_date | total_amount | shares | strategy_type | is_sold | notes |
|----|--------|------------|--------------|--------|---------------|---------|-------|
| 2330_2026-01-24_20260124112000 | 2330 | 2026-01-24 | 50000 | 20 | Basic | FALSE | 台積電測試 |
| 6770_2026-01-24_20260124113000 | 6770 | 2026-01-24 | 100000 | 2000 | Add | FALSE | 力積電加碼 |
| 0050_2026-01-20_20260120150000 | 0050 | 2026-01-20 | 150000 | 100 | Basic | TRUE | 已出場 |

---

## 索引與約束

### 主鍵（Primary Key）
- **欄位**：id
- **說明**：唯一識別每筆記錄

### 索引（Index）
建議在以下欄位建立索引以提升查詢效能：
- ticker（股票代號）
- is_sold（已出場）
- entry_date（進場日期）

### 外鍵（Foreign Key）
無（Google Sheets 不支援外鍵約束）

---

## 資料完整性規則

### 必填欄位檢查
所有標記為「必填」的欄位都不可為空：
- id
- ticker
- entry_date
- total_amount
- shares
- strategy_type
- is_sold

### 資料型態檢查
- ticker：必須為文字格式
- total_amount：必須為正數
- shares：必須為正整數
- strategy_type：必須為 Basic 或 Add
- is_sold：必須為 TRUE 或 FALSE

### 邏輯檢查
- entry_date 不可為未來日期
- total_amount 必須大於 0
- shares 必須大於 0

---

## Google Sheets 特殊設定

### B 欄（ticker）格式設定
⚠️ **重要**：必須設定為純文字格式

**步驟**：
1. 選擇 B 欄
2. 格式 → 數字 → 純文字

**原因**：
- 避免前導零被移除（如 0050 變成 50）
- 確保資料一致性

### 試算表權限設定
必須共用給服務帳戶：
- **Email**：`streamlit-bot@stock-trading-484313.iam.gserviceaccount.com`
- **權限**：編輯者

---

## 版本歷史

| 版本 | 日期 | 修改內容 |
|------|------|---------|
| 1.0 | 2026-01-24 | 初始版本 |

---

## 附註

### 資料遷移注意事項
如果從其他系統遷移資料：
1. 確認欄位順序正確
2. 確認 ticker 為文字格式
3. 確認日期格式為 YYYY-MM-DD
4. 確認 is_sold 為布林值（TRUE/FALSE）

### 備份建議
- 定期匯出 Google Sheets 為 CSV
- 建議每週備份一次
- 重要操作前先備份

### 效能考量
- 單一工作表建議不超過 10,000 筆記錄
- 如需處理更多資料，考慮分表或使用資料庫
